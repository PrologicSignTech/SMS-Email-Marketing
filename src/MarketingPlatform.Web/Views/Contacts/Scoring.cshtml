@{
    ViewData["Title"] = "Contact Scoring";
    Layout = "_LayoutAuthenticated";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-star-fill"></i> Contact Engagement Scoring</h2>
        <button class="btn btn-outline-primary" onclick="loadEngagementData()">
            <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <i class="bi bi-emoji-smile fs-1"></i>
                    <h3 id="highEngagement" class="mt-2">0</h3>
                    <small>High Engagement (80+)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <i class="bi bi-emoji-neutral fs-1"></i>
                    <h3 id="medEngagement" class="mt-2">0</h3>
                    <small>Medium (40-79)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark">
                <div class="card-body text-center">
                    <i class="bi bi-emoji-frown fs-1"></i>
                    <h3 id="lowEngagement" class="mt-2">0</h3>
                    <small>Low (1-39)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-secondary text-white">
                <div class="card-body text-center">
                    <i class="bi bi-emoji-dizzy fs-1"></i>
                    <h3 id="noEngagement" class="mt-2">0</h3>
                    <small>No Activity (0)</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Engagement Table -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Contact Engagement Scores</h5>
            <div class="d-flex gap-2">
                <select class="form-select form-select-sm" id="engagementFilter" style="width: auto;" onchange="filterEngagement()">
                    <option value="">All Scores</option>
                    <option value="high">High (80+)</option>
                    <option value="medium">Medium (40-79)</option>
                    <option value="low">Low (1-39)</option>
                    <option value="none">No Activity (0)</option>
                </select>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="engagementTable" class="table table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Score</th>
                            <th>Messages Sent</th>
                            <th>Delivered</th>
                            <th>Clicks</th>
                            <th>Campaigns</th>
                            <th>Last Activity</th>
                            <th class="no-export text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="engagementTableBody">
                        <tr><td colspan="10" class="text-center py-4">
                            <div class="spinner-border spinner-border-sm"></div> Loading engagement data...
                        </td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Contact Detail Modal -->
<div class="modal fade" id="contactDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactDetailTitle">Contact Engagement Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="contactDetailBody">
                <div class="text-center py-4">
                    <div class="spinner-border"></div>
                    <p class="mt-2">Loading details...</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/contacts-scoring.js" asp-append-version="true"></script>
}
