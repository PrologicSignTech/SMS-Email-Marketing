@{
    ViewData["Title"] = "Import Contacts";
    Layout = "_LayoutAuthenticated";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-upload"></i> Import Contacts</h2>
        <a href="@Url.Action("Index", "Contacts")" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Contacts
        </a>
    </div>

    <div class="row">
        <!-- Import Form -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Upload File</h5>
                </div>
                <div class="card-body">
                    <form id="importForm" enctype="multipart/form-data">
                        <!-- File Type Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">File Type</label>
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="fileType" id="typeCsv" value="csv" checked>
                                    <label class="form-check-label" for="typeCsv">
                                        <i class="bi bi-filetype-csv text-success"></i> CSV
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="fileType" id="typeExcel" value="excel">
                                    <label class="form-check-label" for="typeExcel">
                                        <i class="bi bi-filetype-xlsx text-primary"></i> Excel (.xlsx)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- File Upload Zone -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Select File <span class="text-danger">*</span></label>
                            <div class="upload-zone border rounded-3 p-5 text-center" id="dropZone"
                                 style="border-style: dashed !important; cursor: pointer; background: #f8f9fa;">
                                <i class="bi bi-cloud-arrow-up fs-1 text-primary"></i>
                                <h5 class="mt-3">Drag & drop your file here</h5>
                                <p class="text-muted">or click to browse</p>
                                <input type="file" id="importFile" class="d-none" accept=".csv,.xlsx,.xls">
                                <div id="selectedFile" class="mt-3 d-none">
                                    <div class="d-flex align-items-center justify-content-center gap-2">
                                        <i class="bi bi-file-earmark-check text-success fs-4"></i>
                                        <span id="fileName" class="fw-bold"></span>
                                        <span id="fileSize" class="text-muted small"></span>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearFile()">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Target Group -->
                        <div class="mb-4">
                            <label for="importGroupId" class="form-label fw-bold">Add to Group (Optional)</label>
                            <select class="form-select" id="importGroupId">
                                <option value="">-- No Group (Import only) --</option>
                            </select>
                            <small class="text-muted">Imported contacts will be added to this group</small>
                        </div>

                        <!-- Import Button -->
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary btn-lg" id="importBtn" onclick="startImport()" disabled>
                                <i class="bi bi-upload"></i> Import Contacts
                            </button>
                        </div>
                    </form>

                    <!-- Progress Section -->
                    <div id="importProgress" class="mt-4 d-none">
                        <h5>Importing...</h5>
                        <div class="progress mb-3" style="height: 24px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" id="importProgressBar"
                                 role="progressbar" style="width: 100%;">Processing...</div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="importResults" class="mt-4 d-none">
                        <h5><i class="bi bi-check-circle text-success"></i> Import Complete</h5>
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h4 id="resultTotal" class="text-primary">0</h4>
                                        <small>Total Rows</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h4 id="resultSuccess" class="text-success">0</h4>
                                        <small>Imported</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h4 id="resultDuplicates" class="text-warning">0</h4>
                                        <small>Duplicates</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h4 id="resultErrors" class="text-danger">0</h4>
                                        <small>Failed</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="importErrorDetails" class="mt-3 d-none">
                            <h6>Error Details:</h6>
                            <div class="table-responsive" style="max-height: 200px; overflow-y: auto;">
                                <table class="table table-sm table-bordered">
                                    <thead><tr><th>Row</th><th>Error</th></tr></thead>
                                    <tbody id="errorTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Import Guide</h5>
                </div>
                <div class="card-body">
                    <h6>Required Columns:</h6>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-check-circle text-success"></i> <strong>PhoneNumber</strong> or <strong>Email</strong> (at least one)</li>
                    </ul>

                    <h6 class="mt-3">Optional Columns:</h6>
                    <ul class="list-unstyled small">
                        <li><i class="bi bi-dash"></i> FirstName</li>
                        <li><i class="bi bi-dash"></i> LastName</li>
                        <li><i class="bi bi-dash"></i> Email</li>
                        <li><i class="bi bi-dash"></i> PhoneNumber</li>
                        <li><i class="bi bi-dash"></i> Country</li>
                        <li><i class="bi bi-dash"></i> City</li>
                        <li><i class="bi bi-dash"></i> PostalCode</li>
                    </ul>

                    <h6 class="mt-3">Sample CSV:</h6>
                    <pre class="bg-dark text-light p-3 rounded small">FirstName,LastName,Email,PhoneNumber
John,Doe,john@example.com,+15551234567
Jane,Smith,jane@example.com,+15559876543</pre>

                    <div class="alert alert-info mt-3">
                        <i class="bi bi-lightbulb"></i> <strong>Tip:</strong> Duplicate contacts (matching phone or email) will be detected and reported.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/contacts-import.js" asp-append-version="true"></script>
}
