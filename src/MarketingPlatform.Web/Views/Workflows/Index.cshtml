@{
    ViewData["Title"] = "Workflows";
    Layout = "_LayoutAuthenticated";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-diagram-3"></i> Workflows</h2>
        <button class="btn btn-primary" onclick="showCreateModal()">
            <i class="bi bi-plus-circle"></i> Create Workflow
        </button>
    </div>

    <div class="card">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="workflowTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-filter="all" href="javascript:void(0)">All</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-filter="active" href="javascript:void(0)">Active</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-filter="draft" href="javascript:void(0)">Draft</a>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <div class="input-group" style="max-width: 350px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="workflowSearch" placeholder="Search workflows...">
                </div>
            </div>
            <div id="workflows-list">
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Workflow Modal -->
<div class="modal fade" id="workflowModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="workflowModalTitle"><i class="bi bi-plus-circle me-2"></i>Create Workflow</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="wfEditId" value="">
                <div class="mb-3">
                    <label for="wfName" class="form-label">Workflow Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="wfName" placeholder="Enter workflow name" required>
                </div>
                <div class="mb-3">
                    <label for="wfDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="wfDescription" rows="2" placeholder="Describe this workflow"></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="wfTriggerType" class="form-label">Trigger Type</label>
                        <select class="form-select" id="wfTriggerType">
                            <option value="0">Event</option>
                            <option value="1">Schedule</option>
                            <option value="2">Keyword</option>
                            <option value="3" selected>Manual</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="wfIsActive" class="form-label">Status</label>
                        <select class="form-select" id="wfIsActive">
                            <option value="false" selected>Draft</option>
                            <option value="true">Active</option>
                        </select>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="wfTriggerCriteria" class="form-label">Trigger Criteria (JSON, optional)</label>
                    <textarea class="form-control" id="wfTriggerCriteria" rows="2" placeholder='e.g. {"keyword": "SIGNUP"}'></textarea>
                </div>

                <hr>
                <h6><i class="bi bi-list-ol me-1"></i> Workflow Steps</h6>
                <div id="wfStepsList">
                    <!-- Steps added dynamically -->
                </div>
                <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="addStep()">
                    <i class="bi bi-plus"></i> Add Step
                </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveWorkflowBtn" onclick="saveWorkflow()">
                    <i class="bi bi-save me-1"></i>Save Workflow
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/workflows-index.js"></script>
}
